<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wums</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="wums note">
    <link rel="preload" href="/source-files/assets/css/0.styles.6eaab90e.css" as="style"><link rel="preload" href="/source-files/assets/js/app.13fd1045.js" as="script"><link rel="preload" href="/source-files/assets/js/2.a20b4d8f.js" as="script"><link rel="preload" href="/source-files/assets/js/82.39a8c7b3.js" as="script"><link rel="prefetch" href="/source-files/assets/js/10.f69d7abe.js"><link rel="prefetch" href="/source-files/assets/js/100.42e91a46.js"><link rel="prefetch" href="/source-files/assets/js/101.b0598874.js"><link rel="prefetch" href="/source-files/assets/js/102.d2351edc.js"><link rel="prefetch" href="/source-files/assets/js/103.0630b1e3.js"><link rel="prefetch" href="/source-files/assets/js/104.2f908f86.js"><link rel="prefetch" href="/source-files/assets/js/105.13388b54.js"><link rel="prefetch" href="/source-files/assets/js/106.8dd832b5.js"><link rel="prefetch" href="/source-files/assets/js/107.af46901c.js"><link rel="prefetch" href="/source-files/assets/js/108.7c3193d0.js"><link rel="prefetch" href="/source-files/assets/js/109.7edb6da4.js"><link rel="prefetch" href="/source-files/assets/js/11.b4d6ae5c.js"><link rel="prefetch" href="/source-files/assets/js/110.8ef24dc4.js"><link rel="prefetch" href="/source-files/assets/js/111.2bee3801.js"><link rel="prefetch" href="/source-files/assets/js/112.9ddacbae.js"><link rel="prefetch" href="/source-files/assets/js/113.d2991e42.js"><link rel="prefetch" href="/source-files/assets/js/114.7ce92a7d.js"><link rel="prefetch" href="/source-files/assets/js/115.b5aad82d.js"><link rel="prefetch" href="/source-files/assets/js/12.e008a8b8.js"><link rel="prefetch" href="/source-files/assets/js/13.0dd38efa.js"><link rel="prefetch" href="/source-files/assets/js/14.ebe5d44a.js"><link rel="prefetch" href="/source-files/assets/js/15.b0719545.js"><link rel="prefetch" href="/source-files/assets/js/16.3655dc80.js"><link rel="prefetch" href="/source-files/assets/js/17.6ab44279.js"><link rel="prefetch" href="/source-files/assets/js/18.bfbbb45e.js"><link rel="prefetch" href="/source-files/assets/js/19.5549582a.js"><link rel="prefetch" href="/source-files/assets/js/20.d8f7532f.js"><link rel="prefetch" href="/source-files/assets/js/21.55c8ccf0.js"><link rel="prefetch" href="/source-files/assets/js/22.d4fe78bb.js"><link rel="prefetch" href="/source-files/assets/js/23.77bc14a6.js"><link rel="prefetch" href="/source-files/assets/js/24.a372d476.js"><link rel="prefetch" href="/source-files/assets/js/25.3bbc3e51.js"><link rel="prefetch" href="/source-files/assets/js/26.726febec.js"><link rel="prefetch" href="/source-files/assets/js/27.59ff0db3.js"><link rel="prefetch" href="/source-files/assets/js/28.e349a8e4.js"><link rel="prefetch" href="/source-files/assets/js/29.743be347.js"><link rel="prefetch" href="/source-files/assets/js/3.1b128698.js"><link rel="prefetch" href="/source-files/assets/js/30.31dae421.js"><link rel="prefetch" href="/source-files/assets/js/31.ea828797.js"><link rel="prefetch" href="/source-files/assets/js/32.526dde95.js"><link rel="prefetch" href="/source-files/assets/js/33.d77fc26e.js"><link rel="prefetch" href="/source-files/assets/js/34.ff5b1623.js"><link rel="prefetch" href="/source-files/assets/js/35.a7f41ee1.js"><link rel="prefetch" href="/source-files/assets/js/36.b585d81c.js"><link rel="prefetch" href="/source-files/assets/js/37.c7cb6ed7.js"><link rel="prefetch" href="/source-files/assets/js/38.81450452.js"><link rel="prefetch" href="/source-files/assets/js/39.b5b59832.js"><link rel="prefetch" href="/source-files/assets/js/4.699dc0eb.js"><link rel="prefetch" href="/source-files/assets/js/40.a39742cc.js"><link rel="prefetch" href="/source-files/assets/js/41.ef441eed.js"><link rel="prefetch" href="/source-files/assets/js/42.e77c0f95.js"><link rel="prefetch" href="/source-files/assets/js/43.0500faff.js"><link rel="prefetch" href="/source-files/assets/js/44.11d764f0.js"><link rel="prefetch" href="/source-files/assets/js/45.2bbf2472.js"><link rel="prefetch" href="/source-files/assets/js/46.62e4c8dc.js"><link rel="prefetch" href="/source-files/assets/js/47.53401c13.js"><link rel="prefetch" href="/source-files/assets/js/48.de9dbc60.js"><link rel="prefetch" href="/source-files/assets/js/49.b4341498.js"><link rel="prefetch" href="/source-files/assets/js/5.62830c7d.js"><link rel="prefetch" href="/source-files/assets/js/50.552b6fed.js"><link rel="prefetch" href="/source-files/assets/js/51.6d1f4ebd.js"><link rel="prefetch" href="/source-files/assets/js/52.ab8893a3.js"><link rel="prefetch" href="/source-files/assets/js/53.a3ffb113.js"><link rel="prefetch" href="/source-files/assets/js/54.4a432c17.js"><link rel="prefetch" href="/source-files/assets/js/55.2fb67bff.js"><link rel="prefetch" href="/source-files/assets/js/56.0fe4666c.js"><link rel="prefetch" href="/source-files/assets/js/57.32b4ecdb.js"><link rel="prefetch" href="/source-files/assets/js/58.016380be.js"><link rel="prefetch" href="/source-files/assets/js/59.58c0a710.js"><link rel="prefetch" href="/source-files/assets/js/6.3830cbbc.js"><link rel="prefetch" href="/source-files/assets/js/60.74b5d8ea.js"><link rel="prefetch" href="/source-files/assets/js/61.5689e502.js"><link rel="prefetch" href="/source-files/assets/js/62.439db55d.js"><link rel="prefetch" href="/source-files/assets/js/63.694db7fa.js"><link rel="prefetch" href="/source-files/assets/js/64.7c9e08f4.js"><link rel="prefetch" href="/source-files/assets/js/65.ee694705.js"><link rel="prefetch" href="/source-files/assets/js/66.08b4a6ec.js"><link rel="prefetch" href="/source-files/assets/js/67.5fbe9c26.js"><link rel="prefetch" href="/source-files/assets/js/68.d6afe585.js"><link rel="prefetch" href="/source-files/assets/js/69.ee619461.js"><link rel="prefetch" href="/source-files/assets/js/7.baaec696.js"><link rel="prefetch" href="/source-files/assets/js/70.a8c5d899.js"><link rel="prefetch" href="/source-files/assets/js/71.d9aa887e.js"><link rel="prefetch" href="/source-files/assets/js/72.eccd0043.js"><link rel="prefetch" href="/source-files/assets/js/73.97f894da.js"><link rel="prefetch" href="/source-files/assets/js/74.e3f9951d.js"><link rel="prefetch" href="/source-files/assets/js/75.75cc0500.js"><link rel="prefetch" href="/source-files/assets/js/76.5fb56e2d.js"><link rel="prefetch" href="/source-files/assets/js/77.cbc7b36f.js"><link rel="prefetch" href="/source-files/assets/js/78.1f0922f3.js"><link rel="prefetch" href="/source-files/assets/js/79.34dc5662.js"><link rel="prefetch" href="/source-files/assets/js/8.9c57053d.js"><link rel="prefetch" href="/source-files/assets/js/80.8a4951e7.js"><link rel="prefetch" href="/source-files/assets/js/81.bce06df8.js"><link rel="prefetch" href="/source-files/assets/js/83.f215c615.js"><link rel="prefetch" href="/source-files/assets/js/84.b8722150.js"><link rel="prefetch" href="/source-files/assets/js/85.db0e99af.js"><link rel="prefetch" href="/source-files/assets/js/86.13a7844c.js"><link rel="prefetch" href="/source-files/assets/js/87.cad5cdb5.js"><link rel="prefetch" href="/source-files/assets/js/88.b83f6de1.js"><link rel="prefetch" href="/source-files/assets/js/89.5124b724.js"><link rel="prefetch" href="/source-files/assets/js/9.ef7121e3.js"><link rel="prefetch" href="/source-files/assets/js/90.fd89477c.js"><link rel="prefetch" href="/source-files/assets/js/91.7d4794cc.js"><link rel="prefetch" href="/source-files/assets/js/92.a511ccc9.js"><link rel="prefetch" href="/source-files/assets/js/93.132a9609.js"><link rel="prefetch" href="/source-files/assets/js/94.ff4d8b60.js"><link rel="prefetch" href="/source-files/assets/js/95.785d15c4.js"><link rel="prefetch" href="/source-files/assets/js/96.a2bcf295.js"><link rel="prefetch" href="/source-files/assets/js/97.6fd2b041.js"><link rel="prefetch" href="/source-files/assets/js/98.4a53793b.js"><link rel="prefetch" href="/source-files/assets/js/99.3be514b1.js">
    <link rel="stylesheet" href="/source-files/assets/css/0.styles.6eaab90e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/source-files/" class="home-link router-link-active"><!----> <span class="site-name">wums</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/source-files/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://gitee.com/wmsnote/dashboard/wikis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WiKi
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://gitee.com/wmsnote/source-files" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitEE
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/source-files/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://gitee.com/wmsnote/dashboard/wikis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WiKi
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://gitee.com/wmsnote/source-files" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitEE
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/shell/" class="sidebar-heading clickable router-link-active open"><span>shell</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/source-files/shell/Bash简介.html" class="sidebar-link">Bash简介</a></li><li><a href="/source-files/shell/基本语法.html" class="sidebar-link">基本语法</a></li><li><a href="/source-files/shell/Bash的模式扩展.html" class="sidebar-link">Bash的模式扩展</a></li><li><a href="/source-files/shell/引号和转义.html" class="sidebar-link">引号和转义</a></li><li><a href="/source-files/shell/变量.html" class="sidebar-link">变量</a></li><li><a href="/source-files/shell/字符串操作.html" class="sidebar-link">字符串操作</a></li><li><a href="/source-files/shell/算数运算.html" class="sidebar-link">算数运算</a></li><li><a href="/source-files/shell/Bash行操作.html" class="sidebar-link">Bash行操作</a></li><li><a href="/source-files/shell/目录堆栈.html" class="sidebar-link">目录堆栈</a></li><li><a href="/source-files/shell/Bash脚本入门.html" class="sidebar-link">Bash脚本入门</a></li><li><a href="/source-files/shell/read命令.html" class="sidebar-link">read命令</a></li><li><a href="/source-files/shell/条件判断.html" class="sidebar-link">条件判断</a></li><li><a href="/source-files/shell/循环.html" class="sidebar-link">循环</a></li><li><a href="/source-files/shell/函数.html" class="sidebar-link">函数</a></li><li><a href="/source-files/shell/数组.html" class="sidebar-link">数组</a></li><li><a href="/source-files/shell/set.html" class="sidebar-link">set命令</a></li><li><a href="/source-files/shell/脚本除错.html" class="active sidebar-link">脚本除错</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/source-files/shell/脚本除错.html#_1-常见错误" class="sidebar-link">1. 常见错误</a></li><li class="sidebar-sub-header"><a href="/source-files/shell/脚本除错.html#_2-bash的-x参数" class="sidebar-link">2. bash的-x参数</a></li><li class="sidebar-sub-header"><a href="/source-files/shell/脚本除错.html#_3-环境变量" class="sidebar-link">3. 环境变量</a></li><li class="sidebar-sub-header"><a href="/source-files/shell/脚本除错.html#_4-bash-source" class="sidebar-link">4. BASH_SOURCE</a></li></ul></li><li><a href="/source-files/shell/mktemp_and_trap.html" class="sidebar-link">mktemp命令和trap命令</a></li><li><a href="/source-files/shell/Bash启动环境.html" class="sidebar-link">Bash启动环境</a></li><li><a href="/source-files/shell/命令提示符.html" class="sidebar-link">命令提示符</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/设计模式/" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/prometheus/" class="sidebar-heading clickable"><span>prometheus</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/travis-ci/" class="sidebar-heading clickable"><span>travis-ci教程</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/Dockerfile/" class="sidebar-heading clickable"><span>Dockerfile</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/java/" class="sidebar-heading clickable"><span>Java教程</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/springboot2/" class="sidebar-heading clickable"><span>SpringBoot2.x</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/nginx/" class="sidebar-heading clickable"><span>nginx</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>本章介绍如何对 Shell 脚本除错。</p> <h2 id="_1-常见错误"><a href="#_1-常见错误" class="header-anchor">#</a> 1. 常见错误</h2> <p>编写 Shell 脚本的时候，一定要考虑到命令失败的情况，否则很容易出错。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#! /bin/bash</span>
<span class="token assign-left variable">dir_name</span><span class="token operator">=</span>/path/not/exist

<span class="token builtin class-name">cd</span> <span class="token variable">$dir_name</span>
<span class="token function">rm</span> *
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上面脚本中，如果目录<code>$dir_name</code>不存在，<code>cd $dir_name</code>命令就会执行失败。这时，就不会改变当前目录，脚本会继续执行下去，
导致<code>rm *</code>命令删光当前目录的文件。</p> <p>如果改成下面的样子，也会有问题。</p> <p><code>cd $dir_name &amp;&amp; rm *</code></p> <p>上面脚本中，只有<code>cd $dir_name</code>执行成功，才会执行<code>rm *</code>。但是，如果变量<code>$dir_name</code>为空，<code>cd</code>就会进入用户主目录，从而删光用户主目录的文件。</p> <p>下面的写法才是正确的。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span><span class="token punctuation">[</span> -d <span class="token variable">$dir_name</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> <span class="token variable">$dir_name</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> *
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面代码中，先判断目录$dir_name是否存在，然后才执行其他操作。</p> <p>如果不放心删除什么文件，可以先打印出来看一下。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span><span class="token punctuation">[</span> -d <span class="token variable">$dir_name</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> <span class="token variable">$dir_name</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token function">rm</span> *
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面命令中，<code>echo rm *</code>不会删除文件，只会打印出来要删除的文件。</p> <h2 id="_2-bash的-x参数"><a href="#_2-bash的-x参数" class="header-anchor">#</a> 2. bash的-x参数</h2> <p>bash的-x参数可以在执行每一行命令之前，打印该命令。这样就不用自己输出执行的命令，一旦出错，比较容易追查。</p> <p>下面是一个脚本script.sh。</p> <p><code>echo hello world</code>
加上<code>-x</code>参数，执行每条命令之前，都会显示该命令。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">bash</span> -x script.sh
+ <span class="token builtin class-name">echo</span> hello world
hello world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上面例子中，行首为+的行，显示该行是所要执行的命令，下一行才是该命令的执行结果。</p> <p>下面再看一个-x写在脚本内部的例子。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash -x</span>
<span class="token comment"># trouble: script to demonstrate common errors</span>

<span class="token assign-left variable">number</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$number</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Number is equal to 1.&quot;</span>
<span class="token keyword">else</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Number is not equal to 1.&quot;</span>
<span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>上面的脚本执行之后，会输出每一行命令。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ trouble
+ <span class="token assign-left variable">number</span><span class="token operator">=</span><span class="token number">1</span>
+ <span class="token string">'['</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token string">']'</span>
+ <span class="token builtin class-name">echo</span> <span class="token string">'Number is equal to 1.'</span>
Number is equal to <span class="token number">1</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>输出的命令之前的+号，是由系统变量PS4决定，可以修改这个变量。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PS4</span></span><span class="token operator">=</span><span class="token string">'<span class="token variable">$LINENO</span> + '</span>
$ trouble
<span class="token number">5</span> + <span class="token assign-left variable">number</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token number">7</span> + <span class="token string">'['</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token string">']'</span>
<span class="token number">8</span> + <span class="token builtin class-name">echo</span> <span class="token string">'Number is equal to 1.'</span>
Number is equal to <span class="token number">1</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>另外，set命令也可以设置 Shell 的行为参数，有利于脚本除错，详见《set 命令》一章。</p> <h2 id="_3-环境变量"><a href="#_3-环境变量" class="header-anchor">#</a> 3. 环境变量</h2> <p>有一些环境变量常用于除错。</p> <p>LINENO</p> <p>变量LINENO返回它在脚本里面的行号。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;This is line <span class="token variable">$LINENO</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>执行上面的脚本test.sh，<code>$LINENO</code>会返回3。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ ./test.sh
This is line <span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>FUNCNAME</p> <p>变量FUNCNAME返回一个数组，内容是当前的函数调用堆栈。该数组的0号成员是当前调用的函数，1号成员是调用当前函数的函数，以此类推。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token keyword">function</span> <span class="token function-name function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func1: FUNCNAME0 is <span class="token variable">${FUNCNAME<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func1: FUNCNAME1 is <span class="token variable">${FUNCNAME<span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func1: FUNCNAME2 is <span class="token variable">${FUNCNAME<span class="token punctuation">[</span>2<span class="token punctuation">]</span>}</span>&quot;</span>
  func2
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function-name function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func2: FUNCNAME0 is <span class="token variable">${FUNCNAME<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func2: FUNCNAME1 is <span class="token variable">${FUNCNAME<span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func2: FUNCNAME2 is <span class="token variable">${FUNCNAME<span class="token punctuation">[</span>2<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token punctuation">}</span>

func1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>执行上面的脚本test.sh，结果如下。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ ./test.sh
func1: FUNCNAME0 is func1
func1: FUNCNAME1 is main
func1: FUNCNAME2 is
func2: FUNCNAME0 is func2
func2: FUNCNAME1 is func1
func2: FUNCNAME2 is main
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上面例子中，执行func1时，变量FUNCNAME的0号成员是func1，1号成员是调用func1的主脚本main。执行func2时，变量FUNCNAME的0号成员是func2，1号成员是调用func2的func1。</p> <h2 id="_4-bash-source"><a href="#_4-bash-source" class="header-anchor">#</a> 4. BASH_SOURCE</h2> <p>变量BASH_SOURCE返回一个数组，内容是当前的脚本调用堆栈。</p> <p>该数组的0号成员是当前执行的脚本，1号成员是调用当前脚本的脚本，以此类推，跟变量FUNCNAME是一一对应关系。</p> <p>下面有两个子脚本lib1.sh和lib2.sh。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">function</span> <span class="token function-name function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func1: BASH_SOURCE0 is <span class="token variable">${<span class="token environment constant">BASH_SOURCE</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func1: BASH_SOURCE1 is <span class="token variable">${<span class="token environment constant">BASH_SOURCE</span><span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func1: BASH_SOURCE2 is <span class="token variable">${<span class="token environment constant">BASH_SOURCE</span><span class="token punctuation">[</span>2<span class="token punctuation">]</span>}</span>&quot;</span>
  func2
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function-name function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func2: BASH_SOURCE0 is <span class="token variable">${<span class="token environment constant">BASH_SOURCE</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func2: BASH_SOURCE1 is <span class="token variable">${<span class="token environment constant">BASH_SOURCE</span><span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func2: BASH_SOURCE2 is <span class="token variable">${<span class="token environment constant">BASH_SOURCE</span><span class="token punctuation">[</span>2<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>然后，主脚本main.sh调用上面两个子脚本。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>


<span class="token builtin class-name">source</span> lib1.sh
<span class="token builtin class-name">source</span> lib2.sh

func1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>执行主脚本main.sh，会得到下面的结果。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ ./main.sh
func1: BASH_SOURCE0 is lib1.sh
func1: BASH_SOURCE1 is ./main.sh
func1: BASH_SOURCE2 is
func2: BASH_SOURCE0 is lib2.sh
func2: BASH_SOURCE1 is lib1.sh
func2: BASH_SOURCE2 is ./main.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上面例子中，执行函数func1时，变量BASH_SOURCE的0号成员是func1所在的脚本lib1.sh，1号成员是主脚本main.sh；执行函数func2时，变量BASH_SOURCE的0号成员是func2所在的脚本lib2.sh，1号成员是调用func2的脚本lib1.sh。</p> <p>BASH_LINENO</p> <p>变量BASH_LINENO返回一个数组，内容是每一轮调用对应的行号。<code>${BASH_LINENO[$i]}</code>跟<code>${FUNCNAME[$i]}</code>是一一对应关系，表示<code>${FUNCNAME[$i]}</code>在调用它的脚本文件<code>${BASH_SOURCE[$i+1]}</code>里面的行号。</p> <p>下面有两个子脚本lib1.sh和lib2.sh。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>
<span class="token keyword">function</span> <span class="token function-name function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func1: BASH_LINENO is <span class="token variable">${<span class="token environment constant">BASH_LINENO</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func1: FUNCNAME is <span class="token variable">${FUNCNAME<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func1: BASH_SOURCE is <span class="token variable">${<span class="token environment constant">BASH_SOURCE</span><span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>&quot;</span>

  func2
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function-name function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func2: BASH_LINENO is <span class="token variable">${<span class="token environment constant">BASH_LINENO</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func2: FUNCNAME is <span class="token variable">${FUNCNAME<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;func2: BASH_SOURCE is <span class="token variable">${<span class="token environment constant">BASH_SOURCE</span><span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>然后，主脚本main.sh调用上面两个子脚本。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>


<span class="token builtin class-name">source</span> lib1.sh
<span class="token builtin class-name">source</span> lib2.sh

func1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>执行主脚本main.sh，会得到下面的结果。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ ./main.sh
func1: <span class="token environment constant">BASH_LINENO</span> is <span class="token number">7</span>
func1: FUNCNAME is func1
func1: <span class="token environment constant">BASH_SOURCE</span> is main.sh
func2: <span class="token environment constant">BASH_LINENO</span> is <span class="token number">8</span>
func2: FUNCNAME is func2
func2: <span class="token environment constant">BASH_SOURCE</span> is lib1.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上面例子中，函数func1是在main.sh的第7行调用，函数func2是在lib1.sh的第8行调用的。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/24/2020, 6:17:16 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/source-files/shell/set.html" class="prev">
        set命令
      </a></span> <span class="next"><a href="/source-files/shell/mktemp_and_trap.html">
        mktemp命令和trap命令
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/source-files/assets/js/app.13fd1045.js" defer></script><script src="/source-files/assets/js/2.a20b4d8f.js" defer></script><script src="/source-files/assets/js/82.39a8c7b3.js" defer></script>
  </body>
</html>
