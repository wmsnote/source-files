<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wums</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="wums note">
    <link rel="preload" href="/source-files/assets/css/0.styles.6eaab90e.css" as="style"><link rel="preload" href="/source-files/assets/js/app.b763afb2.js" as="script"><link rel="preload" href="/source-files/assets/js/2.a20b4d8f.js" as="script"><link rel="preload" href="/source-files/assets/js/51.4877f05d.js" as="script"><link rel="prefetch" href="/source-files/assets/js/10.b2fd2b20.js"><link rel="prefetch" href="/source-files/assets/js/100.950fa711.js"><link rel="prefetch" href="/source-files/assets/js/101.816d59c4.js"><link rel="prefetch" href="/source-files/assets/js/102.6d8cf1dc.js"><link rel="prefetch" href="/source-files/assets/js/103.faff5a55.js"><link rel="prefetch" href="/source-files/assets/js/104.5cae389c.js"><link rel="prefetch" href="/source-files/assets/js/105.74d0185a.js"><link rel="prefetch" href="/source-files/assets/js/106.afd2fd11.js"><link rel="prefetch" href="/source-files/assets/js/107.ff0c56c3.js"><link rel="prefetch" href="/source-files/assets/js/108.1035bb47.js"><link rel="prefetch" href="/source-files/assets/js/109.746c46a8.js"><link rel="prefetch" href="/source-files/assets/js/11.6cfeb465.js"><link rel="prefetch" href="/source-files/assets/js/12.f9fd9730.js"><link rel="prefetch" href="/source-files/assets/js/13.dd009f24.js"><link rel="prefetch" href="/source-files/assets/js/14.0233273d.js"><link rel="prefetch" href="/source-files/assets/js/15.8a3a0cdb.js"><link rel="prefetch" href="/source-files/assets/js/16.240b83af.js"><link rel="prefetch" href="/source-files/assets/js/17.d51ff9ca.js"><link rel="prefetch" href="/source-files/assets/js/18.9ebb0da4.js"><link rel="prefetch" href="/source-files/assets/js/19.367ba92d.js"><link rel="prefetch" href="/source-files/assets/js/20.86bbfae4.js"><link rel="prefetch" href="/source-files/assets/js/21.c93f8151.js"><link rel="prefetch" href="/source-files/assets/js/22.6a8d8dc7.js"><link rel="prefetch" href="/source-files/assets/js/23.d79240e5.js"><link rel="prefetch" href="/source-files/assets/js/24.30ee928b.js"><link rel="prefetch" href="/source-files/assets/js/25.0a8040de.js"><link rel="prefetch" href="/source-files/assets/js/26.df350862.js"><link rel="prefetch" href="/source-files/assets/js/27.89450194.js"><link rel="prefetch" href="/source-files/assets/js/28.294e3fc6.js"><link rel="prefetch" href="/source-files/assets/js/29.5d301e33.js"><link rel="prefetch" href="/source-files/assets/js/3.1496f34b.js"><link rel="prefetch" href="/source-files/assets/js/30.2cd75ac4.js"><link rel="prefetch" href="/source-files/assets/js/31.46490d17.js"><link rel="prefetch" href="/source-files/assets/js/32.c83ebc2d.js"><link rel="prefetch" href="/source-files/assets/js/33.f7a41714.js"><link rel="prefetch" href="/source-files/assets/js/34.90b3952e.js"><link rel="prefetch" href="/source-files/assets/js/35.398154b7.js"><link rel="prefetch" href="/source-files/assets/js/36.f56a5d5f.js"><link rel="prefetch" href="/source-files/assets/js/37.a95b4d21.js"><link rel="prefetch" href="/source-files/assets/js/38.6c2b1c96.js"><link rel="prefetch" href="/source-files/assets/js/39.1271fc22.js"><link rel="prefetch" href="/source-files/assets/js/4.6984b4d0.js"><link rel="prefetch" href="/source-files/assets/js/40.84ebd818.js"><link rel="prefetch" href="/source-files/assets/js/41.9f42589c.js"><link rel="prefetch" href="/source-files/assets/js/42.ebfa0f72.js"><link rel="prefetch" href="/source-files/assets/js/43.7480b80d.js"><link rel="prefetch" href="/source-files/assets/js/44.f7d82c69.js"><link rel="prefetch" href="/source-files/assets/js/45.b6c961ab.js"><link rel="prefetch" href="/source-files/assets/js/46.7f05c4ef.js"><link rel="prefetch" href="/source-files/assets/js/47.3ec256a4.js"><link rel="prefetch" href="/source-files/assets/js/48.61a96f42.js"><link rel="prefetch" href="/source-files/assets/js/49.a9054a50.js"><link rel="prefetch" href="/source-files/assets/js/5.62830c7d.js"><link rel="prefetch" href="/source-files/assets/js/50.2609d277.js"><link rel="prefetch" href="/source-files/assets/js/52.550e8c16.js"><link rel="prefetch" href="/source-files/assets/js/53.832161e7.js"><link rel="prefetch" href="/source-files/assets/js/54.6dac3cf6.js"><link rel="prefetch" href="/source-files/assets/js/55.737c80b3.js"><link rel="prefetch" href="/source-files/assets/js/56.17e79d68.js"><link rel="prefetch" href="/source-files/assets/js/57.25444e73.js"><link rel="prefetch" href="/source-files/assets/js/58.f46e9695.js"><link rel="prefetch" href="/source-files/assets/js/59.5c7f3c17.js"><link rel="prefetch" href="/source-files/assets/js/6.576f3577.js"><link rel="prefetch" href="/source-files/assets/js/60.7bc9b70e.js"><link rel="prefetch" href="/source-files/assets/js/61.9133e8a4.js"><link rel="prefetch" href="/source-files/assets/js/62.e34b4454.js"><link rel="prefetch" href="/source-files/assets/js/63.4a92432c.js"><link rel="prefetch" href="/source-files/assets/js/64.c538bedf.js"><link rel="prefetch" href="/source-files/assets/js/65.1e7cb3f2.js"><link rel="prefetch" href="/source-files/assets/js/66.1871ca26.js"><link rel="prefetch" href="/source-files/assets/js/67.a934e909.js"><link rel="prefetch" href="/source-files/assets/js/68.e2657924.js"><link rel="prefetch" href="/source-files/assets/js/69.7505e8c8.js"><link rel="prefetch" href="/source-files/assets/js/7.ad02f7a4.js"><link rel="prefetch" href="/source-files/assets/js/70.3bd6dee7.js"><link rel="prefetch" href="/source-files/assets/js/71.13824561.js"><link rel="prefetch" href="/source-files/assets/js/72.3a88b8e9.js"><link rel="prefetch" href="/source-files/assets/js/73.24135e51.js"><link rel="prefetch" href="/source-files/assets/js/74.5bc9f96e.js"><link rel="prefetch" href="/source-files/assets/js/75.6fef9340.js"><link rel="prefetch" href="/source-files/assets/js/76.05e1b555.js"><link rel="prefetch" href="/source-files/assets/js/77.415ae1c1.js"><link rel="prefetch" href="/source-files/assets/js/78.33573ec8.js"><link rel="prefetch" href="/source-files/assets/js/79.36e18488.js"><link rel="prefetch" href="/source-files/assets/js/8.e7a11f73.js"><link rel="prefetch" href="/source-files/assets/js/80.5a29c2ae.js"><link rel="prefetch" href="/source-files/assets/js/81.aba4b9bc.js"><link rel="prefetch" href="/source-files/assets/js/82.d97706e4.js"><link rel="prefetch" href="/source-files/assets/js/83.cabafa78.js"><link rel="prefetch" href="/source-files/assets/js/84.16af11d9.js"><link rel="prefetch" href="/source-files/assets/js/85.a7d61af7.js"><link rel="prefetch" href="/source-files/assets/js/86.2eecef68.js"><link rel="prefetch" href="/source-files/assets/js/87.0d7eda52.js"><link rel="prefetch" href="/source-files/assets/js/88.2e8f1557.js"><link rel="prefetch" href="/source-files/assets/js/89.107129ab.js"><link rel="prefetch" href="/source-files/assets/js/9.bc1abdf2.js"><link rel="prefetch" href="/source-files/assets/js/90.50719f11.js"><link rel="prefetch" href="/source-files/assets/js/91.ae9960a9.js"><link rel="prefetch" href="/source-files/assets/js/92.8d26bb2a.js"><link rel="prefetch" href="/source-files/assets/js/93.0a90b523.js"><link rel="prefetch" href="/source-files/assets/js/94.57737416.js"><link rel="prefetch" href="/source-files/assets/js/95.7ed73938.js"><link rel="prefetch" href="/source-files/assets/js/96.e5a63160.js"><link rel="prefetch" href="/source-files/assets/js/97.9ee50570.js"><link rel="prefetch" href="/source-files/assets/js/98.8a0dc25c.js"><link rel="prefetch" href="/source-files/assets/js/99.79f1cbd4.js">
    <link rel="stylesheet" href="/source-files/assets/css/0.styles.6eaab90e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/source-files/" class="home-link router-link-active"><!----> <span class="site-name">wums</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/source-files/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://gitee.com/wmsnote/dashboard/wikis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WiKi
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://gitee.com/wmsnote/source-files" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitEE
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/source-files/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://gitee.com/wmsnote/dashboard/wikis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WiKi
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://gitee.com/wmsnote/source-files" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitEE
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/shell/" class="sidebar-heading clickable"><span>shell</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/设计模式/" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/prometheus/" class="sidebar-heading clickable"><span>prometheus</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/travis-ci/" class="sidebar-heading clickable"><span>travis-ci教程</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/Dockerfile/" class="sidebar-heading clickable"><span>Dockerfile</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/java/" class="sidebar-heading clickable"><span>Java教程</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/springboot2/" class="sidebar-heading clickable"><span>SpringBoot2.x</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-files/nginx/" class="sidebar-heading clickable router-link-active open"><span>nginx</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/source-files/nginx/nginx-configuration-combat.html" class="active sidebar-link">极简教程常用场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/source-files/nginx/nginx-configuration-combat.html#outline" class="sidebar-link">Outline</a></li><li class="sidebar-sub-header"><a href="/source-files/nginx/nginx-configuration-combat.html#installation-and-use" class="sidebar-link">Installation and Use</a></li><li class="sidebar-sub-header"><a href="/source-files/nginx/nginx-configuration-combat.html#nginx-configuration-combat" class="sidebar-link">nginx configuration combat</a></li><li class="sidebar-sub-header"><a href="/source-files/nginx/nginx-configuration-combat.html#reference" class="sidebar-link">reference</a></li></ul></li><li><a href="/source-files/nginx/install.html" class="sidebar-link">install</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ol><li><a href="#outline">Outline</a></li> <li><a href="#installation-and-use">Installation and Use</a> <ol><li><a href="#installation">installation</a></li> <li><a href="#use">use</a></li></ol></li> <li><a href="#nginx-configuration-combat">nginx configuration combat</a> <ol><li><a href="#http-reverse-proxy-configuration">http reverse proxy configuration</a></li> <li><a href="#load-balancing-configuration">Load Balancing Configuration</a></li> <li><a href="#site-configuration-of-multiple-webapp">Site configuration of multiple webapp</a></li> <li><a href="#https-reverse-proxy-configuration">https reverse proxy configuration</a></li> <li><a href="#static-site-configuration">Static Site Configuration</a></li> <li><a href="#build-a-file-server">Build a file server</a></li> <li><a href="#cross-domain-solutions">Cross-domain solutions</a></li></ol></li> <li><a href="#reference">reference</a></li></ol> <h2 id="outline"><a href="#outline" class="header-anchor">#</a> Outline</h2> <p><strong>what is Nginx?</strong></p> <p>Nginx (engine x)  is a lightweight Web server, reverse proxy server and e-mail (IMAP / POP3) proxy server.</p> <p><img src="https://wums.oss-cn-beijing.aliyuncs.com/nginx/whatisnginx.jpeg" alt=""></p> <p><strong>What is a reverse proxy?</strong></p> <p>Reverse proxy (Reverse Proxy) mode refers to the proxy server to accept connection requests on the internet, and then forwards the request to the server on the internal network, and returns the result obtained from the server to the client on request internet connection, At this point the external proxy server on the performance of a reverse proxy server.</p> <h2 id="installation-and-use"><a href="#installation-and-use" class="header-anchor">#</a> Installation and Use</h2> <h3 id="installation"><a href="#installation" class="header-anchor">#</a> installation</h3> <p>Please refer to the detailed installation method: Nginx installation</p> <h3 id="use"><a href="#use" class="header-anchor">#</a> use</h3> <p>nginx is relatively simple to use, is a few commands.</p> <p>Common to the following commands:</p> <table><thead><tr><th>Command</th> <th>Comment</th></tr></thead> <tbody><tr><td>nginx -s stop</td> <td>快速关闭Nginx，可能不保存相关信息，并迅速终止web服务。</td></tr> <tr><td>nginx -s quit</td> <td>平稳关闭Nginx，保存相关信息，有安排的结束web服务。</td></tr> <tr><td>nginx -s reload</td> <td>因改变了Nginx相关配置，需要重新加载配置而重载。</td></tr> <tr><td>nginx -s reopen</td> <td>重新打开日志文件。</td></tr> <tr><td>nginx -c filename</td> <td>为 Nginx 指定一个配置文件，来代替缺省的。</td></tr> <tr><td>nginx -t</td> <td>不运行，而仅仅测试配置文件。nginx 将检查配置文件的语法的正确性。</td></tr> <tr><td>nginx -v</td> <td>显示 nginx 的版本。</td></tr> <tr><td>nginx -V</td> <td>显示 nginx 的版本，编译器版本和配置参数。</td></tr></tbody></table> <p>If you do not want to knock on every command, a start can be added a new batch file in the installation directory nginx startup.bat , double-click to run. It reads as follows:</p> <div class="language-bat line-numbers-mode"><pre class="language-text"><code>@echo off
rem 如果启动前已经启动nginx并记录下pid文件，会kill指定进程
nginx.exe -s stop

rem 测试配置文件语法正确性
nginx.exe -t -c conf/nginx.conf

rem 显示版本信息
nginx.exe -v

rem 按照指定配置去启动nginx
nginx.exe -c conf/nginx.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>If you are running on Linux, write a shell script, very much the same.</p> <h2 id="nginx-configuration-combat"><a href="#nginx-configuration-combat" class="header-anchor">#</a> nginx configuration combat</h2> <p>I have always believed that various configurations or a combination of the actual development tools to tell the story, will make people easier to understand.</p> <h3 id="http-reverse-proxy-configuration"><a href="#http-reverse-proxy-configuration" class="header-anchor">#</a> http reverse proxy configuration</h3> <p>Let's achieve a small goal: do not consider the complexity of the configuration, just completed a reverse http proxy.</p> <p>nginx.conf configuration file as follows:
Note: conf/nginx.conf is nginx default profile. You can also use nginx -c to specify your profile</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment">#运行用户</span>
<span class="token comment">#user somebody;</span>

<span class="token comment">#启动进程,通常设置成和cpu的数量相等</span>
<span class="token keyword">worker_processes</span>  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#全局错误日志</span>
<span class="token keyword">error_log</span>  D<span class="token punctuation">:</span><span class="token operator">/</span>Tools<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.10</span><span class="token number">.1</span><span class="token operator">/</span>logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
<span class="token keyword">error_log</span>  D<span class="token punctuation">:</span><span class="token operator">/</span>Tools<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.10</span><span class="token number">.1</span><span class="token operator">/</span>logs<span class="token operator">/</span>notice<span class="token punctuation">.</span>log  notice<span class="token punctuation">;</span>
<span class="token keyword">error_log</span>  D<span class="token punctuation">:</span><span class="token operator">/</span>Tools<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.10</span><span class="token number">.1</span><span class="token operator">/</span>logs<span class="token operator">/</span>info<span class="token punctuation">.</span>log  info<span class="token punctuation">;</span>

<span class="token comment">#PID文件，记录当前启动的nginx的进程ID</span>
<span class="token keyword">pid</span>        D<span class="token punctuation">:</span><span class="token operator">/</span>Tools<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.10</span><span class="token number">.1</span><span class="token operator">/</span>logs<span class="token operator">/</span>nginx<span class="token punctuation">.</span><span class="token keyword">pid</span><span class="token punctuation">;</span>

<span class="token comment">#工作模式及连接数上限</span>
<span class="token keyword">events</span> <span class="token punctuation">{</span>
    <span class="token keyword">worker_connections</span> <span class="token number">1024</span><span class="token punctuation">;</span>    <span class="token comment">#单个后台worker process进程的最大并发链接数</span>
<span class="token punctuation">}</span>

<span class="token comment">#设定http服务器，利用它的反向代理功能提供负载均衡支持</span>
<span class="token keyword">http</span> <span class="token punctuation">{</span>
    <span class="token comment">#设定mime类型(邮件支持类型),类型由mime.types文件定义</span>
    <span class="token keyword">include</span>       D<span class="token punctuation">:</span><span class="token operator">/</span>Tools<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.10</span><span class="token number">.1</span><span class="token operator">/</span>conf<span class="token operator">/</span>mime<span class="token punctuation">.</span><span class="token keyword">types</span><span class="token punctuation">;</span>
    <span class="token keyword">default_type</span>  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>

    <span class="token comment">#设定日志</span>
    <span class="token keyword">log_format</span>  main  <span class="token string">'[$remote_addr] - [$remote_user] [$time_local] &quot;$request&quot; '</span>
                      <span class="token string">'$status $body_bytes_sent &quot;$http_referer&quot; '</span>
                      <span class="token string">'&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;'</span><span class="token punctuation">;</span>

    <span class="token keyword">access_log</span>    D<span class="token punctuation">:</span><span class="token operator">/</span>Tools<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.10</span><span class="token number">.1</span><span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log main<span class="token punctuation">;</span>
    rewrite_log     on<span class="token punctuation">;</span>

    <span class="token comment">#sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，</span>
    <span class="token comment">#必须设为 on,如果用来进行下载等应用磁盘IO重负载应用，可设置为 off，以平衡磁盘与网络I/O处理速度，降低系统的uptime.</span>
    <span class="token keyword">sendfile</span>        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#连接超时时间</span>
    <span class="token keyword">keepalive_timeout</span>  <span class="token number">120</span><span class="token punctuation">;</span>
    <span class="token keyword">tcp_nodelay</span>        on<span class="token punctuation">;</span>

    <span class="token comment">#gzip压缩开关</span>
    <span class="token comment">#gzip  on;</span>

    <span class="token comment">#设定实际的服务器列表</span>
    <span class="token keyword">upstream</span> zp_server1<span class="token punctuation">{</span>
        <span class="token keyword">server</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8089</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#HTTP服务器</span>
    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token comment">#监听80端口，80端口是知名端口号，用于HTTP协议</span>
        <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>

        <span class="token comment">#定义使用www.xx.com访问</span>
        <span class="token keyword">server_name</span>  www<span class="token punctuation">.</span>helloworld<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

        <span class="token comment">#首页</span>
        <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html

        <span class="token comment">#指向webapp的目录</span>
        <span class="token keyword">root</span> D<span class="token punctuation">:</span>\<span class="token number">01</span>_Workspace\Project\github\zp\SpringNotes\spring<span class="token operator">-</span>security\spring<span class="token operator">-</span>shiro\src\main\webapp<span class="token punctuation">;</span>

        <span class="token comment">#编码格式</span>
        <span class="token keyword">charset</span> utf<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>

        <span class="token comment">#代理配置参数</span>
        <span class="token keyword">proxy_connect_timeout</span> <span class="token number">180</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_send_timeout</span> <span class="token number">180</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_read_timeout</span> <span class="token number">180</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarder<span class="token operator">-</span>For <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>

        <span class="token comment">#反向代理的路径（和upstream绑定），location 后面设置映射的路径</span>
        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>zp_server1<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#静态文件，nginx自己处理</span>
        <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span>images<span class="token operator">|</span>javascript<span class="token operator">|</span>js<span class="token operator">|</span>css<span class="token operator">|</span>flash<span class="token operator">|</span>media<span class="token operator">|</span>static<span class="token punctuation">)</span><span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">root</span> D<span class="token punctuation">:</span>\<span class="token number">01</span>_Workspace\Project\github\zp\SpringNotes\spring<span class="token operator">-</span>security\spring<span class="token operator">-</span>shiro\src\main\webapp\views<span class="token punctuation">;</span>
            <span class="token comment">#过期30天，静态文件不怎么更新，过期可以设大一点，如果频繁更新，则可以设置得小一点。</span>
            <span class="token keyword">expires</span> <span class="token number">30</span>d<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#设定查看Nginx状态的地址</span>
        <span class="token keyword">location</span> <span class="token operator">/</span>NginxStatus <span class="token punctuation">{</span>
            <span class="token keyword">stub_status</span>           on<span class="token punctuation">;</span>
            <span class="token keyword">access_log</span>            on<span class="token punctuation">;</span>
            <span class="token keyword">auth_basic</span>            <span class="token string">&quot;NginxStatus&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">auth_basic_user_file</span>  conf<span class="token operator">/</span>htpasswd<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#禁止访问 .htxxx 文件</span>
        <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token operator">/</span>\<span class="token punctuation">.</span>ht <span class="token punctuation">{</span>
            <span class="token keyword">deny</span> all<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#错误处理页面（可选择性配置）</span>
        <span class="token comment">#error_page   404              /404.html;</span>
        <span class="token comment">#error_page   500 502 503 504  /50x.html;</span>
        <span class="token comment">#location = /50x.html {</span>
        <span class="token comment">#    root   html;</span>
        <span class="token comment">#}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br></div></div><p>Well, let's try it:</p> <ol><li><p>Start webapp, attention is bound to start port of nginx and  upstream port settings consistent.</p></li> <li><p>Change the host: in C:\Windows\System32\host file in the drivers \etc directory, add a DNS record</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1 www.helloworld.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>Start earlier in order startup.bat</p></li> <li><p>Access www.helloworld.com in the browser, not surprisingly, already visited.</p></li></ol> <h3 id="load-balancing-configuration"><a href="#load-balancing-configuration" class="header-anchor">#</a> Load Balancing Configuration</h3> <p>In the previous example, only point to a proxy server.</p> <p>However, the actual site of operations, most of all have multiple servers running the same app, then you need to use load balancing to split.</p> <p>nginx can also achieve a simple load balancing.</p> <p>Assume that such a scenario: an application deployed on 192.168.1.11:80,192.168.1.12:80,192.168.1.13:80 three linux server environment. Domain called www.helloworld.com, public IP is 192.168.1.11. Nginx deployed on the server where the public IP, load balancing process all requests.</p> <p>nginx.conf configuration is as follows:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">http</span> <span class="token punctuation">{</span>
     <span class="token comment">#设定mime类型,类型由mime.type文件定义</span>
    <span class="token keyword">include</span>       <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>mime<span class="token punctuation">.</span><span class="token keyword">types</span><span class="token punctuation">;</span>
    <span class="token keyword">default_type</span>  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>
    <span class="token comment">#设定日志格式</span>
    <span class="token keyword">access_log</span>    <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>access<span class="token punctuation">.</span>log<span class="token punctuation">;</span>

    <span class="token comment">#设定负载均衡的服务器列表</span>
    <span class="token keyword">upstream</span> load_balance_server <span class="token punctuation">{</span>
        <span class="token comment">#weigth参数表示权值，权值越高被分配到的几率越大</span>
        <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.11</span><span class="token punctuation">:</span><span class="token number">80</span>   weight<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.12</span><span class="token punctuation">:</span><span class="token number">80</span>   weight<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.13</span><span class="token punctuation">:</span><span class="token number">80</span>   weight<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   <span class="token comment">#HTTP服务器</span>
   <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token comment">#侦听80端口</span>
        <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>

        <span class="token comment">#定义使用www.xx.com访问</span>
        <span class="token keyword">server_name</span>  www<span class="token punctuation">.</span>helloworld<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

        <span class="token comment">#对所有请求进行负载均衡请求</span>
        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">root</span>        <span class="token operator">/</span><span class="token keyword">root</span><span class="token punctuation">;</span>                 <span class="token comment">#定义服务器的默认网站根目录位置</span>
            <span class="token keyword">index</span>       <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>  <span class="token comment">#定义首页索引文件的名称</span>
            <span class="token keyword">proxy_pass</span>  <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>load_balance_server <span class="token punctuation">;</span><span class="token comment">#请求转向load_balance_server 定义的服务器列表</span>

            <span class="token comment">#以下是一些反向代理的配置(可选择性配置)</span>
            <span class="token comment">#proxy_redirect off;</span>
            <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span><span class="token punctuation">;</span>
            <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
            <span class="token comment">#后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span>
            <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
            <span class="token keyword">proxy_connect_timeout</span> <span class="token number">90</span><span class="token punctuation">;</span>          <span class="token comment">#nginx跟后端服务器连接超时时间(代理连接超时)</span>
            <span class="token keyword">proxy_send_timeout</span> <span class="token number">90</span><span class="token punctuation">;</span>             <span class="token comment">#后端服务器数据回传时间(代理发送超时)</span>
            <span class="token keyword">proxy_read_timeout</span> <span class="token number">90</span><span class="token punctuation">;</span>             <span class="token comment">#连接成功后，后端服务器响应时间(代理接收超时)</span>
            <span class="token keyword">proxy_buffer_size</span> <span class="token number">4</span>k<span class="token punctuation">;</span>              <span class="token comment">#设置代理服务器（nginx）保存用户头信息的缓冲区大小</span>
            <span class="token keyword">proxy_buffers</span> <span class="token number">4</span> <span class="token number">32</span>k<span class="token punctuation">;</span>               <span class="token comment">#proxy_buffers缓冲区，网页平均在32k以下的话，这样设置</span>
            <span class="token keyword">proxy_busy_buffers_size</span> <span class="token number">64</span>k<span class="token punctuation">;</span>       <span class="token comment">#高负荷下缓冲大小（proxy_buffers*2）</span>
            <span class="token keyword">proxy_temp_file_write_size</span> <span class="token number">64</span>k<span class="token punctuation">;</span>    <span class="token comment">#设定缓存文件夹大小，大于这个值，将从upstream服务器传</span>

            <span class="token keyword">client_max_body_size</span> <span class="token number">10</span>m<span class="token punctuation">;</span>          <span class="token comment">#允许客户端请求的最大单文件字节数</span>
            <span class="token keyword">client_body_buffer_size</span> <span class="token number">128</span>k<span class="token punctuation">;</span>      <span class="token comment">#缓冲区代理缓冲用户端请求的最大字节数</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="site-configuration-of-multiple-webapp"><a href="#site-configuration-of-multiple-webapp" class="header-anchor">#</a> Site configuration of multiple webapp</h3> <p>When a website more functional, often need some independent functional modules spin-off, independent maintenance. In this case, usually, there will be more webapp.</p> <p>For example: If www.helloworld.com site has several webapp, finance (finance), product (product), admin (User Center). Access to these applications are distinguished by the context (context):</p> <p>www.helloworld.com/finance/</p> <p>www.helloworld.com/product/</p> <p>www.helloworld.com/admin/</p> <p>We know that the default port number for http is 80, if you start these three webapp applications simultaneously on a single server, with all 80 ports, definitely succeed. So, these three applications need to bind a different port number, respectively.</p> <p>So, the question is, when the user actually accessing www.helloworld.com site, access to different webapp, you would not also with corresponding port number to access it. So, again, you need to use a reverse proxy to do the processing.</p> <p>Configuration is not difficult to see how to do it:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">http</span> <span class="token punctuation">{</span>
    <span class="token comment">#此处省略一些基本配置</span>

    <span class="token keyword">upstream</span> product_server<span class="token punctuation">{</span>
        <span class="token keyword">server</span> www<span class="token punctuation">.</span>helloworld<span class="token punctuation">.</span>com<span class="token punctuation">:</span><span class="token number">8081</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">upstream</span> admin_server<span class="token punctuation">{</span>
        <span class="token keyword">server</span> www<span class="token punctuation">.</span>helloworld<span class="token punctuation">.</span>com<span class="token punctuation">:</span><span class="token number">8082</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">upstream</span> finance_server<span class="token punctuation">{</span>
        <span class="token keyword">server</span> www<span class="token punctuation">.</span>helloworld<span class="token punctuation">.</span>com<span class="token punctuation">:</span><span class="token number">8083</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token comment">#此处省略一些基本配置</span>
        <span class="token comment">#默认指向product的server</span>
        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>product_server<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">location</span> <span class="token operator">/</span>product<span class="token operator">/</span><span class="token punctuation">{</span>
            <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>product_server<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">location</span> <span class="token operator">/</span>admin<span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>admin_server<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">location</span> <span class="token operator">/</span>finance<span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>finance_server<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="https-reverse-proxy-configuration"><a href="#https-reverse-proxy-configuration" class="header-anchor">#</a> https reverse proxy configuration</h3> <p>Some of the higher security requirements of the site, may use HTTPS (ssl communication using standard HTTP protocol security).</p> <p>Here is not science HTTP protocol and SSL standards. However, using https nginx configuration needs to know that:</p> <ul><li>HTTPS fixed port number is 443, unlike HTTP port 80</li> <li>Standard SSL security certificate needs to be introduced, so nginx.conf you need to specify the certificate and its corresponding key</li></ul> <p>Other http and reverse proxy is basically the same, but in  Server some different parts of the configuration.</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment">#HTTP服务器</span>
  <span class="token keyword">server</span> <span class="token punctuation">{</span>
      <span class="token comment">#监听443端口。443为知名端口号，主要用于HTTPS协议</span>
      <span class="token keyword">listen</span>       <span class="token number">443</span> <span class="token keyword">ssl</span><span class="token punctuation">;</span>

      <span class="token comment">#定义使用www.xx.com访问</span>
      <span class="token keyword">server_name</span>  www<span class="token punctuation">.</span>helloworld<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

      <span class="token comment">#ssl证书文件位置(常见证书文件格式为：crt/pem)</span>
      <span class="token keyword">ssl_certificate</span>      cert<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>
      <span class="token comment">#ssl证书key位置</span>
      <span class="token keyword">ssl_certificate_key</span>  cert<span class="token punctuation">.</span>key<span class="token punctuation">;</span>

      <span class="token comment">#ssl配置参数（选择性配置）</span>
      <span class="token keyword">ssl_session_cache</span>    shared<span class="token punctuation">:</span><span class="token keyword">SSL</span><span class="token punctuation">:</span><span class="token number">1</span>m<span class="token punctuation">;</span>
      <span class="token keyword">ssl_session_timeout</span>  <span class="token number">5</span>m<span class="token punctuation">;</span>
      <span class="token comment">#数字签名，此处使用MD5</span>
      <span class="token keyword">ssl_ciphers</span>  HIGH<span class="token punctuation">:</span><span class="token operator">!</span>aNULL<span class="token punctuation">:</span><span class="token operator">!</span>MD5<span class="token punctuation">;</span>
      <span class="token keyword">ssl_prefer_server_ciphers</span>  on<span class="token punctuation">;</span>

      <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
          <span class="token keyword">root</span>   <span class="token operator">/</span><span class="token keyword">root</span><span class="token punctuation">;</span>
          <span class="token keyword">index</span>  <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="static-site-configuration"><a href="#static-site-configuration" class="header-anchor">#</a> Static Site Configuration</h3> <p>Sometimes, we need to configure a static site (ie a bunch of static html files and resources).</p> <p>For example: If all the static resources are placed in the  /app/dist directory, we only need the  nginx.conf host can be specified as well as the site's home page.</p> <p>Configuration is as follows:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">worker_processes</span>  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">events</span> <span class="token punctuation">{</span>
    <span class="token keyword">worker_connections</span>  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">http</span> <span class="token punctuation">{</span>
    <span class="token keyword">include</span>       mime<span class="token punctuation">.</span><span class="token keyword">types</span><span class="token punctuation">;</span>
    <span class="token keyword">default_type</span>  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>
    <span class="token keyword">sendfile</span>        on<span class="token punctuation">;</span>
    <span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token keyword">gzip</span> on<span class="token punctuation">;</span>
    <span class="token keyword">gzip_types</span> text<span class="token operator">/</span>plain application<span class="token operator">/</span>x<span class="token operator">-</span>javascript text<span class="token operator">/</span>css application<span class="token operator">/</span>xml text<span class="token operator">/</span>javascript application<span class="token operator">/</span>javascript image<span class="token operator">/</span>jpeg image<span class="token operator">/</span>gif image<span class="token operator">/</span>png<span class="token punctuation">;</span>
    <span class="token keyword">gzip_vary</span> on<span class="token punctuation">;</span>

    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
        <span class="token keyword">server_name</span>  static<span class="token punctuation">.</span>zp<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>

        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">root</span> <span class="token operator">/</span>app<span class="token operator">/</span>dist<span class="token punctuation">;</span>
            <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>
            <span class="token comment">#转发任何请求到 index.html</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>Then, HOST:</p> <p>127.0.0.1 static.zp.cn</p> <p>In this case, access static.zp.cn in the local browser, you can access a static site.</p> <h3 id="build-a-file-server"><a href="#build-a-file-server" class="header-anchor">#</a> Build a file server</h3> <p>Sometimes, teams need to archive some data or information, the file server is essential. Use Nginx can be very quick and easy to build a simple file service.</p> <p>Nginx configuration points:</p> <ul><li><p>Autoindex will open to display the directory, the default is not open.</p></li> <li><p>Autoindex_exact_size will open to display the file size.</p></li> <li><p>Autoindex_localtime will open to display the file modification time.</p></li> <li><p>root used to set the root path open for the file services.</p></li> <li><p>charset set to  charset utf-8,gbk;avoid Chinese garbage problem (after setting the windows server is still garbled, it temporarily no solution is found).</p></li></ul> <p>One of the most simplified configuration is as follows:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code>
<span class="token keyword">autoindex</span> on<span class="token punctuation">;</span><span class="token comment"># 显示目录</span>
<span class="token keyword">autoindex_exact_size</span> on<span class="token punctuation">;</span><span class="token comment"># 显示文件大小</span>
<span class="token keyword">autoindex_localtime</span> on<span class="token punctuation">;</span><span class="token comment"># 显示文件时间</span>

<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">charset</span>      utf<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span>gbk<span class="token punctuation">;</span> <span class="token comment"># windows 服务器下设置后，依然乱码，暂时无解</span>
    <span class="token keyword">listen</span>       <span class="token number">9050</span> default_server<span class="token punctuation">;</span>
    <span class="token keyword">listen</span>       <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token number">9050</span> default_server<span class="token punctuation">;</span>
    <span class="token keyword">server_name</span>  _<span class="token punctuation">;</span>
    <span class="token keyword">root</span>         <span class="token operator">/</span>share<span class="token operator">/</span>fs<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="cross-domain-solutions"><a href="#cross-domain-solutions" class="header-anchor">#</a> Cross-domain solutions</h3> <p>web development field, separated front and rear ends frequently used mode. In this mode, the front and rear ends are each independently of the web application, for example: the rear end is a Java program, a distal React Vue or application.</p> <p>Separate web app when visiting each other, there is bound to cross-domain problems. Solve the problem of cross-domain There are two general ideas:</p> <h4 id="hearts"><a href="#hearts" class="header-anchor">#</a> HEARTS</h4> <p>Set HTTP response header at the back-end server, you need to run the domain name is added to join  Access-Control-Allow-Originin.</p> <h4 id="jsonp"><a href="#jsonp" class="header-anchor">#</a> jsonp</h4> <p>The rear end of the request, json configuration data, and returns, with the distal end cross-domain jsonp.</p> <p>These two ideas, this article does not discuss.</p> <p>It should be noted, nginx according to the first idea, but also provides a solution to cross-domain solutions.</p> <p>For example: www.helloworld.com site was created by a front-end app, consisting of a back-end app. Front-end port number is 9000, the port number is 8080.</p> <p>If you use the front and rear http interact request will be rejected because of the cross-domain problems. Take a look, nginx is how to solve it:</p> <p>First, set the enable-cors.conf cors file:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment"># allow origin list</span>
<span class="token keyword">set</span> <span class="token variable">$ACAO</span> <span class="token string">'*'</span><span class="token punctuation">;</span>

<span class="token comment"># set single origin</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$http_origin</span> <span class="token operator">~</span><span class="token operator">*</span> <span class="token punctuation">(</span>www<span class="token punctuation">.</span>helloworld<span class="token punctuation">.</span>com<span class="token punctuation">)</span>$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">set</span> <span class="token variable">$ACAO</span> <span class="token variable">$http_origin</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$cors</span> <span class="token operator">=</span> <span class="token string">&quot;trueget&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">&quot;$http_origin&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span><span class="token punctuation">;</span>
    <span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Methods'</span> <span class="token string">'GET, POST, OPTIONS'</span><span class="token punctuation">;</span>
    <span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Headers'</span> <span class="token string">'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> <span class="token string">'OPTIONS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">set</span> <span class="token variable">$cors</span> <span class="token string">&quot;${cors}options&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">set</span> <span class="token variable">$cors</span> <span class="token string">&quot;${cors}get&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">set</span> <span class="token variable">$cors</span> <span class="token string">&quot;${cors}post&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>Next, in your server  include enable-cors.conf to the introduction of cross-domain configuration:</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment"># ----------------------------------------------------</span>
<span class="token comment"># 此文件为项目 nginx 配置片段</span>
<span class="token comment"># 可以直接在 nginx config 中 include（推荐）</span>
<span class="token comment"># 或者 copy 到现有 nginx 中，自行配置</span>
<span class="token comment"># www.helloworld.com 域名需配合 dns hosts 进行配置</span>
<span class="token comment"># 其中，api 开启了 cors，需配合本目录下另一份配置文件</span>
<span class="token comment"># ----------------------------------------------------</span>
<span class="token keyword">upstream</span> front_server<span class="token punctuation">{</span>
  <span class="token keyword">server</span> www<span class="token punctuation">.</span>helloworld<span class="token punctuation">.</span>com<span class="token punctuation">:</span><span class="token number">9000</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">upstream</span> api_server<span class="token punctuation">{</span>
  <span class="token keyword">server</span> www<span class="token punctuation">.</span>helloworld<span class="token punctuation">.</span>com<span class="token punctuation">:</span><span class="token number">8080</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span>  www<span class="token punctuation">.</span>helloworld<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

  <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token operator">^</span><span class="token operator">/</span>api<span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">include</span> enable<span class="token operator">-</span>cors<span class="token punctuation">.</span>conf<span class="token punctuation">;</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>api_server<span class="token punctuation">;</span>
    <span class="token keyword">rewrite</span> <span class="token string">&quot;^/api/(.*)$&quot;</span> <span class="token operator">/</span>$<span class="token number">1</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token operator">^</span><span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>front_server<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>This, is complete.</p> <h2 id="reference"><a href="#reference" class="header-anchor">#</a> reference</h2> <ul><li><p>Nginx's Chinese Wiki</p></li> <li><p>Nginx installation</p></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/28/2020, 2:45:47 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/source-files/springboot2/logback-spring.html" class="prev">
        springboot集成logback日志
      </a></span> <span class="next"><a href="/source-files/nginx/install.html">
        install
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/source-files/assets/js/app.b763afb2.js" defer></script><script src="/source-files/assets/js/2.a20b4d8f.js" defer></script><script src="/source-files/assets/js/51.4877f05d.js" defer></script>
  </body>
</html>
